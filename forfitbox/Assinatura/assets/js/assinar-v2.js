!function(t){t.fn.vtexSubscription=function(e){var a=t.extend({title:"Escolha a o período:",htmButton:"<span>Assinar</span>",minPrice:2e4,discount:10,discountType:"percentual",showInfo:!0,linkInfo:"Como funciona a assinatura?",shippingDay:[5,15,25],plan:[{frequency:"2",periodicity:"week",text:"Quinzenal - A cada 2 semanas"},{frequency:"1",periodicity:"month",text:"Mensal - Todo mês"},{frequency:"2",periodicity:"month",text:"Bimestral - A cada 2 mêses"}],after:"modal",callback:"onpage"},e),n=this,s={init:function(){this.event(),this.setup()},setup:function(){var e=t(".value-field.Similar"),s="",i="",o="";if(0!=a.discount&&("percentual"==a.discountType?s='<div class="discount">Assine e economize '+a.discount+"%</div>":"nominal"==a.discountType&&(s='<div class="discount">Assine e economize '+a.discount/100+"</div>")),skuJson.skus[0].available=skuJson.skus[0].availablequantity>0){if(o=skuJson.skus[0].sku,t.each(a.plan,(function(t,e){i+='<option value="'+e.frequency+" "+e.periodicity+'">'+e.text+"</option>"})),n.append('<label class="flex" for="Assinar"><input type="radio" class="item-buy" id="Assinar" name="tipo-produto" checked value="'+o+'"><div class="group">'+a.htmButton+s+'<select id="frequency"><option value="0">'+a.title+"</option>"+i+"</select></div></label>"),a.showInfo&&n.append('<a class="link-info show-modal" rel="jn-info">'+a.linkInfo+"</a>"),n.append('<div class="c-row action"><input type="number" value="1" min="1" id="input-custom-quant"><button class="buy buy-subscription" data-sku="'+o+'">Assinar</button></div>'),e.length){var r=e.text();r=r.replace("93668","73639"),t.getJSON("/api/catalog_system/pub/products/search?fq=productId:"+r,(function(t){var e=t[0].items[0].sellers[0].commertialOffer.AvailableQuantity;e>0&&e<9999?n.prepend('<label class="flex" for="Comprar"><input type="radio" class="item-buy" id="Comprar" name="tipo-produto" value="'+t[0].items[0].itemId+'"><div class="group"><span>Comprar</span></div></label>'):n.prepend('<div class="aviseme" style="display: flex;align-items: center;font-size: 14px;padding: 20px 0;clear: both;line-height: 18px;font-weight: 700;"><svg style="width: 30px;height: 30px;margin: 0 10px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>Produto disponível apenas para assinatura</div>')}))}}else t("._aviseme").show()},event:function(){t("body").on("change","#frequency",(function(){t("input#Assinar").click(),t("#frequency").removeClass("obr").addClass("clt")})),t("body").on("change",".item-buy",(function(){var e=t(this).attr("id"),a=t(".action .buy"),n=t(this).val();a.html(e).attr("data-sku",n),"Assinar"==e?(a.addClass("buy-subscription"),t("#frequency").removeClass("obr").addClass("clt")):(t("#frequency").removeClass("obr clt"),a.removeClass("buy-subscription"))})),t("body").on("click",".show-modal",(function(e){e.preventDefault();var a=t(this).attr("rel");t("."+a).fadeIn(100),t("body").addClass("noScroll")})),t("body").on("click",".hide-modal",(function(e){e.preventDefault(),t(this).parents(".ext-modal").hide(),t("body").removeClass("noScroll")})),t("body").on("click",".remove-modal",(function(e){e.preventDefault(),t(this).parents(".ext-modal").remove(),t("body").removeClass("noScroll")})),t("body").on("click",".remove-cart-qty",(function(e){e.preventDefault();var a=t(this).parents(".cartSkuGroup").find(".select-qty"),n=a.val();""==n&&(n=2),n>1&&a.val(parseInt(n)-1).trigger("change")})),t("body").on("click",".add-cart-qty",(function(e){e.preventDefault();var a=t(this).parents(".cartSkuGroup").find(".select-qty"),n=a.val();""==n&&(n=0),a.val(parseInt(n)+1).trigger("change")})),t("body").on("change",".select-qty",(function(){var e=parseInt(t(this).parents(".cartSkuGroup").attr("data-index")),a=t(this).val();t(".jn-cart").addClass("load"),setTimeout((function(){vtexjs.checkout.getOrderForm().then((function(t){var n={index:parseInt(e),quantity:parseInt(a)};return vtexjs.checkout.updateItems([n],null,!1)})).done((function(e){t(".ext-modal.recurly").removeClass("load"),s.orderform(e)}))}),100)})),t("body").on("click",".cartSkuGroup .removeItem",(function(){var e=parseInt(t(this).parents(".cartSkuGroup").attr("data-index"));t(".jn-cart").addClass("load"),setTimeout((function(){vtexjs.checkout.getOrderForm().then((function(t){t.items[0];var a=[{index:e,quantity:0}];return vtexjs.checkout.removeItems(a)})).done((function(t){s.orderform(t)}))}),100)})),t(".wrap-subscription").on("click",".action .buy",(function(){var e=t(this).attr("data-sku"),n=t("#input-custom-quant").val();esse=t(this),esse.addClass("load"),setTimeout((function(){if(esse.hasClass("buy-subscription")){var i=t("#frequency").val(),o="",r="",c="";if("0"==i)return t("#frequency").addClass("obr").focus(),esse.removeClass("load"),!1;r=(o=i.split(" "))[0],c=o[1],values=a.shippingDay,today=new Date,sday=today.getDate(),day=parseInt(sday),purchaseday=values.reduce((function(t,e){return Math.abs(e-day)<Math.abs(t-day)?e:t})),s.buySubscription(e,n,r,c,purchaseday)}else s.buyUnique(e,n)}),10)}))},buyUnique:function(e,n){t.ajax({type:"GET",url:window.location.origin+"/checkout/cart/add?sku="+e+"&qty="+n+"&seller=1&sc=1",success:function(){"onpage"==a.callback?(minicart.miniCartInit(),t(".carrinho").click()):window.location.href="/checkout#/cart"},error:function(){},complete:function(){t(".buy.load").removeClass("load")}})},buySubscription:function(e,n,i,o,r){e=e;var c,u,l=i,d=(o=o,new Date),p=new Date;n=t("#input-custom-quant").val();t(".jn-cart").addClass("load"),p.setDate(d.getDate()+1095);var m={"vtex.subscription.key.frequency":i+" "+o,"vtex.subscription.key.purchaseday":r};setTimeout((function(){t.ajax({type:"GET",url:window.location.origin+"/checkout/cart/add?sku="+e+"&qty=1&seller=1&sc=1",success:function(){vtexjs.checkout.getOrderForm().done((function(e){setTimeout((function(){vtexjs.checkout.getOrderForm().then((function(t){return c=parseInt(t.items.length)-1,vtexjs.checkout.addItemAttachment(c,"vtex.subscription.assinatura",m)})).done((function(e){if(u=e.orderFormId,parseInt(n)>1){var i={index:c,quantity:n};vtexjs.checkout.updateItems([i],null,!1)}var r={subscriptions:[{itemIndex:c,plan:{frequency:{interval:l,periodicity:o.toUpperCase()},validity:{begin:s.formatDate(d),end:s.formatDate(p)},type:"RECURRING_PAYMENT"}}],expectedOrderFormSections:["items","totalizers","clientProfileData","shippingData","paymentData","sellers","messages","marketingData","clientPreferencesData","storePreferencesData","giftRegistryData","ratesAndBenefitsData","openTextField","commercialConditionData","customData"]};t.ajax({headers:{Accept:"application/json","Content-Type":"application/json"},url:"/api/checkout/pub/orderForm/"+u+"/attachments/subscriptionData",type:"POST",data:JSON.stringify(r),success:function(e,n,i){"onpage"==a.callback?"modal"==a.after?vtexjs.checkout.getOrderForm().done((function(t){s.orderform(t)})):(minicart.miniCartInit(),t(".carrinho").click()):window.location.href="/checkout#/cart"},error:function(t,e,a){},complete:function(){t(".buy.load").removeClass("load")}})}))}),30)}))},error:function(){},complete:function(){}})}),30)},orderform:function(e){var n="",i=0;t.each(e.items,(function(e,o){var r=o.attachments;if(r.length){var c=o.sellingPrice,u=o.name,l=o.quantity,d=o.imageUrl,p=o.productId,m=o.id,f=(c/100).toFixed(2),v=r[0].content,h="Bimestral";"1 month"==v[Object.keys(v)[0]]&&(h="Mensal"),i+=l*c,n+='<ul class="c-row cartSkuGroup" data-sku="'+m+'" data-product="'+p+'" data-index="'+e+'"><li class="cartSkuImage"><img src="'+d+'" alt="'+u+'"></li><li class="cartSkuDados"><div class="cartSkuName">'+u+'</div><div class="cartSkuQuantity"><div class="c-row cart-qty"><label>Qtde.:</label><span><a class="remove-cart-qty">-</a><input type="text" class="select-qty" maxlength="4" readonly value="'+l+'"><a class="add-cart-qty">+</a></span></div></div><div class="cartSkuPrice">R$ '+f+'</div><div class="cartSkuPeriodicity">'+h+'</div><a class="removeItem">×</a></li></ul>'}if(0!=a.minPrice){var y=(a.minPrice/100).toFixed(2),b=(i/100).toFixed(2),k=t(".restante-subscription");k.find("h5 .value").html(y),k.find(".total-order").html("R$ "+b),k.find(".total-minimo").html("R$ "+y),k.show(),setTimeout((function(){s.check(i)}),100),setTimeout((function(){s.check(i)}),100)}t(".items-subscription").html(n),t(".jn-cart").show().removeClass("load"),t("body").addClass("noScroll")}))},check:function(e){var n=a.minPrice,s=n-e,i=100*e/n,o="cbottom";i>70&&(o="ctop"),e>n?(t(".cart-subscription").removeClass("disable").attr("href","/checkout#/cart"),t(".restante-subscription .barra").css("width","100%"),t(".restante-subscription").addClass("_ok"),t(".restante-subscription .restante").html("Valor mínimo atingido")):(t(".cart-subscription").addClass("disable").removeAttr("href","/checkout#/cart"),t(".restante-subscription").removeClass("_ok"),t(".restante-subscription .barra").css("width",i+"%"),t(".restante-subscription .restante").html("Restam apenas <span>R$ "+(s/100).toFixed(2)+"</span>")),t(".restante-subscription .total-order").html("R$ "+(e/100).toFixed(2)).css("left",i+"%").removeClass("cbottom ctop").addClass(o)},formatDate:function(t){var e=t.getDate().toString(),a=1==e.length?"0"+e:e,n=(t.getMonth()+1).toString(),s=1==n.length?"0"+n:n;return t.getFullYear()+"-"+s+"-"+a}};s.init()}}(jQuery),$(document).ready((function(){$(".wrap-subscription").vtexSubscription({minPrice:2e4,type:"select",htmButton:"<span>Assinar</span>",showInfo:!0})}));